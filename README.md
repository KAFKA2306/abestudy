# abestudy
アベノミクス期間の日本個別株データを収集し、年次最適ポートフォリオを算出するプロジェクト。

## 実行
```
uv run python -m src.run_pipeline
uv run python -m src.run_visualization
```

## 解析条件
- 政策対象: アベノミクス（三本の矢、2012-12-26〜2020-09-16）
- 市場データ: 日経平均採用銘柄の日次終値・出来高（2009-01-01〜2025-09-31）、yfinance から取得し Asia/Tokyo でタイムスタンプ化
- ユニバース: 年初時点の「日経平均採用銘柄」スナップショットを使用、銘柄比率は 0〜20%、空売り禁止
- 推定手法: 年次リバランスの平均分散最適化（ウォークフォワード）
- レポート形式: YAML（period、universe、portfolio 配下に weights・risk_metrics・数値は小数点以下 2 桁）

## ワークフロー概要
```
abestudy/
├── data/raw        # yfinance 取得データ (.yaml)
├── src/data_io     # YAML I/O
├── src/ingestion   # データ取得
├── src/analytics   # 最適化
├── src/reporting   # レポート生成
└── reports/portfolio
```

## 情報リーク対策
1. 年次リバランスごとに取得したユニバース・スナップショットを保存し、当該年の意思決定では同時点の構成銘柄のみを使用
2. ルールベースでユニバース条件を固定し、最低銘柄数を確保
3. ウォークフォワード最適化と意思決定ログのバージョニング
4. CI/CD 上でデータ・コードのハッシュ記録とレビュー手続きの義務化
5. 未来日参照を検知する自動テスト整備

## ポートフォリオの例（2013-2020）
| 年 | リターン | ボラティリティ | シャープ | 最大ドローダウン | メモ |
| --- | --- | --- | --- | --- | --- |
| 2013 | 70.2% | 26.7% | 2.63 | -15.1% | 長期平均を牽引 |
| 2014 | 34.8% | 21.0% | 1.66 | -11.2% | 安定成長 |
| 2015 | 27.3% | 24.5% | 1.11 | -25.7% | ドローダウン拡大 |
| 2016 | 37.3% | 28.7% | 1.30 | -18.8% | 高ボラ下で堅調 |
| 2017 | 35.5% | 15.1% | 2.36 | -7.7% | 低ボラで高効率 |
| 2018 | -5.0% | 20.3% | -0.24 | -25.7% | 唯一のマイナス |
| 2019 | 39.9% | 15.4% | 2.60 | -8.2% | リスク効率改善 |
| 2020 | 46.2% | 30.8% | 1.50 | -34.5% | 高リターンと急落 |

![年次最適ポートフォリオの例](reports/figures/yearly_portfolio_longrun.svg)
