# abestudy
アベノミクス期間の日本個別株データを収集し、年次最適ポートフォリオを算出するプロジェクト。

## 実行
```
uv run python -m src.run_pipeline
uv run python -m src.run_visualization
```

## 解析条件
- 政策対象: アベノミクス（三本の矢、2012-12-26〜2020-09-16）
- 市場データ: 日経平均採用銘柄の日次終値・出来高（2009-01-01〜2025-09-31）、yfinance から取得し Asia/Tokyo でタイムスタンプ化
- ユニバース: 年初時点の「日経平均採用銘柄」スナップショットを使用、銘柄比率は 0〜20%、空売り禁止
- 推定手法: 年次リバランスの平均分散最適化（LOOKBACK_DAYS = 252における 最大sharpe ratio）
- レポート形式: YAML（period、universe、portfolio 配下に weights・risk_metrics・数値は小数点以下 2 桁）

## ワークフロー概要
```
abestudy/
├── data/raw        # yfinance 取得データ (.yaml)
├── src/data_io     # YAML I/O
├── src/ingestion   # データ取得
├── src/analytics   # 最適化
├── src/reporting   # レポート生成
└── reports/portfolio
```

## 情報リーク対策
1. 年次リバランスごとに取得したユニバース・スナップショットを保存し、当該年の意思決定では同時点の構成銘柄のみを使用
2. ルールベースでユニバース条件を固定し、最低銘柄数を確保
3. ウォークフォワード最適化と意思決定ログのバージョニング
4. CI/CD 上でデータ・コードのハッシュ記録とレビュー手続きの義務化
5. 未来日参照を検知する自動テスト整備

## 年次指標一覧
| 年 | 年率リターン | ボラティリティ | シャープレシオ | 最大ドローダウン |
|---|-------------|----------------|-----------------|-------------------|
| 2013 | 56.9% | 24.8% | 2.30 | -17.5% |
| 2014 | 41.6% | 26.2% | 1.59 | -15.3% |
| 2015 | 22.9% | 25.6% | 0.89 | -21.8% |
| 2016 | -5.0% | 26.2% | -0.19 | -21.2% |
| 2017 | 16.3% | 15.9% | 1.03 | -11.8% |
| 2018 | -19.0% | 20.6% | -0.93 | -29.8% |
| 2019 | 12.4% | 16.6% | 0.75 | -8.0% |
| 2020 | 25.9% | 24.1% | 1.07 | -25.8% |

![yearly_portfolio_longrun](reports/figures/yearly_portfolio_longrun.svg)
