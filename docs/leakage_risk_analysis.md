# 情報リークに関するリスク分析

本ドキュメントでは、銘柄ユニバース選定およびポートフォリオ構成プロセスに潜む情報リークの欠点を具体的に整理し、それぞれに対する改善策を提示する。

## 1. ユニバース選定における情報リーク

### 欠点の指摘
- **将来情報の混入**: 銘柄採用・除外を決める際に、後知恵で判明した業績指標やイベント結果を遡及的に利用すると、当時利用可能でなかった将来情報がユニバースに反映される。
- **スクリーニング境界の歪み**: バックテストで良好な結果を出した銘柄特徴量をもとにユニバース条件を再定義すると、実運用時には得られない統計的優位を人工的に生み出す。
- **調査対象期間のミスアライン**: データ取得期間とユニバース決定日が一致していない場合、決定時点では未公開の四半期決算や配当情報を無意識に含める恐れがある。
- **銘柄数の過度な限定**: 本プロジェクトの現状ユニバースは銘柄数が著しく少なく、少数の個別銘柄の挙動が全体統計を歪め、検証結果が偶然性に大きく左右される。

### 改善策
- **決定時点のデータスナップショット化**: ユニバース決定日をキーに、利用可能だった指標をスナップショットとして保存し、バックテストもそのスナップショットに限定する。
- **ルールベースのロックダウン**: ユニバース選定ルールを事前に策定・文書化し、検証期間中は条件を固定して再調整を行わない。
- **ラグ設定とデータスタンピング**: 財務指標やイベント情報に公開ラグ（例: 45 日）を強制し、データベース上で公開日と参照可能日を明示するメタデータ列を追加する。
- **ユニバースの段階的拡張**: 最低限の銘柄数しきい値を設け、外部データソースや代替指数から候補を追加してユニバースを厚くし、統計的な頑健性を確保する。

## 2. ポートフォリオ構成における情報リーク

### 欠点の指摘
- **最適化での未来データ使用**: 目標リターンや共分散を計算する際に、リバランス日より後のリターン系列を利用すると、実際には実現不可能な最適化結果が得られる。
- **トランザクションコスト未反映**: 取引コストを無視した最適化を実施し、後からコストを差し引くと、構成比率自体が実運用可能性を欠く。
- **パフォーマンス報告の後付け調整**: ポートフォリオ構成を作成後に、観測されたリスク指標やスタイルエクスポージャーに合わせてウェイトを再調整すると、元の意思決定プロセスが失われる。

### 改善策
- **ウォークフォワード最適化**: 各リバランスごとに、当日までのヒストリカルデータのみを用いて推定を行い、その結果をロックして前方期間で検証する。
- **シミュレーション段階でのコスト統合**: 最適化関数にスプレッドやスリッページを内生化し、目的関数に取引コストペナルティを導入する。
- **意思決定ログのバージョニング**: ポートフォリオ構成を決定した時点の入力データ・パラメータ・出力をすべてバージョン管理し、後段の評価手順からは読み取り専用にする。

## 3. 横断的なコントロール

- **監査可能なワークフロー**: データ取得、ユニバース決定、ポートフォリオ最適化、レポート生成を CI/CD パイプラインに組み込み、使用データとコードのハッシュをログに残す。
- **レビュー手続きの義務化**: 情報リークを検知するためのチェックリストを定義し、リリース前レビューで必ず確認する。
- **自動テストによる再発防止**: 未来日のデータ参照や未公表データアクセスがあった場合に失敗するユニットテスト・統合テストを追加する。

## 4. 優先度の高い改善

1. **ユニバースの拡張を最優先で実施**: 銘柄数の極端な少なさは他の対策の効果を覆すため、最初に最低銘柄数ラインの設定と候補銘柄の追加を行う。
2. **スナップショット運用の整備**: 拡張したユニバースを当時入手可能な情報に限定して保存し、検証プロセスでのリークを未然に防ぐ。
3. **ウォークフォワード検証の自動化**: 上記 2 点と併せて導入することで、ポートフォリオ構成時の未来情報利用を防ぎ、改善効果を定量的に監視できるようにする。
